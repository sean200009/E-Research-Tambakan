<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Research Tambakan</title>
<link rel="stylesheet" href="style.css">
<style>
/* Additional styles for collapsible cards */
.paper-card {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  cursor: pointer;
  transition: all 0.2s ease;
}
.paper-card.open {
  background: #f0f4ff;
}
.paper-card .abstract {
  display: none;
  margin-top: 0.5rem;
}
.paper-card.open .abstract {
  display: block;
}
</style>
</head>
<body>

<!-- STUDENT LOGIN -->
<div id="studentLogin" class="box">
  <h3>Student Login</h3>
  <input id="studentName" placeholder="Enter your name">
  <button onclick="studentLogin()">Enter</button>
  <hr>
  <button class="secondary" onclick="showAdminLogin()">Admin Login</button>
</div>

<!-- ADMIN LOGIN -->
<div id="adminLogin" class="box hidden">
  <h3>Admin Login</h3>
  <input id="adminUser" placeholder="Username">
  <input id="adminPass" type="password" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
  <button class="secondary" onclick="backToStudent()">Back</button>
</div>

<!-- STUDENT APP -->
<div id="studentApp" class="hidden">
<header>
  <h1>E-Research Tambakan</h1>
  <p id="welcomeStudent">Offline Research Index</p>
  <button class="secondary" onclick="logout()">Logout</button>
</header>

<main>
  <h2>Select Research Field</h2>
  <div class="fields">
    <button class="field-btn" onclick="selectField('MCS')">MCS</button>
    <button class="field-btn" onclick="selectField('RIM')">RIM</button>
    <button class="field-btn" onclick="selectField('LS')">LS</button>
    <button class="field-btn" onclick="selectField('PS')">PS</button>
    <button class="field-btn" onclick="selectField('STEMIE')">STEMIE</button>
  </div>

  <div id="papers"></div>
</main>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
<header>
  <h1>Admin Panel</h1>
  <button class="secondary" onclick="logout()">Logout</button>
</header>

<main>
  <h3>Add Study</h3>
  <select id="field">
    <option>MCS</option>
    <option>RIM</option>
    <option>LS</option>
    <option>PS</option>
    <option>STEMIE</option>
  </select>
  <input id="title" placeholder="Title">
  <input id="author" placeholder="Author">
  <input id="year" placeholder="Year">
  <textarea id="abstract" placeholder="Abstract" style="width:100%;height:80px;"></textarea>
  <input id="keywords" placeholder="Keywords (comma separated)">
  <button onclick="addStudy()">Save Study</button>
</main>
</div>

<footer>Â© 2026 E-Research Tambakan</footer>

<script>
const ADMIN_USER = "admin";
const ADMIN_PASS = "tambakan123";

// DOM Elements
const studentName = document.getElementById("studentName");
const studentLoginDivElement = document.getElementById("studentLogin");
const studentApp = document.getElementById("studentApp");
const welcomeStudent = document.getElementById("welcomeStudent");

const adminUser = document.getElementById("adminUser");
const adminPass = document.getElementById("adminPass");
const adminLoginDiv = document.getElementById("adminLogin");
const adminPanel = document.getElementById("adminPanel");

let papers = JSON.parse(localStorage.getItem("papers")) || {};

// Load preloaded papers if localStorage empty
if (!localStorage.getItem("papers")) {
  fetch("papers.json")
    .then(res => res.json())
    .then(data => {
      papers = data;
      localStorage.setItem("papers", JSON.stringify(papers));
      displayAllPapers();
    });
} else {
  papers = JSON.parse(localStorage.getItem("papers"));
}

// STUDENT LOGIN
function studentLogin() {
  const name = studentName.value.trim();
  if (!name) return alert("Enter your name");

  studentLoginDiv(false);
  studentApp.classList.remove("hidden");
  welcomeStudent.innerText = `Welcome, ${name}!`;
  displayAllPapers();
}

function studentLoginDiv(show) {
  studentLoginDivElement.classList.toggle("hidden", !show);
}

// ADMIN LOGIN
function adminLogin() {
  if (adminUser.value === ADMIN_USER && adminPass.value === ADMIN_PASS) {
    adminLoginDiv.classList.add("hidden");
    adminPanel.classList.remove("hidden");
  } else {
    alert("Wrong credentials");
  }
}

function showAdminLogin() {
  studentLoginDiv(false);
  adminLoginDiv.classList.remove("hidden");
}

function backToStudent() {
  adminLoginDiv.classList.add("hidden");
  studentLoginDiv(true);
}

// LOGOUT
function logout() {
  location.reload();
}

// Display all papers
function displayAllPapers() {
  const allFields = Object.keys(papers);
  let html = "";
  allFields.forEach(field => {
    if (papers[field].length > 0) {
      html += `<h3>${field}</h3>`;
      papers[field].forEach(p => {
        html += `<div class="paper-card">
          <strong>${p.title}</strong><br>
          <small>${p.author} (${p.year})</small>
          <div class="abstract">${p.abstract}</div>
          ${p.keywords.map(k => `<span class="tag">${k}</span>`).join("")}
        </div>`;
      });
    }
  });
  document.getElementById("papers").innerHTML = html;
  makeCardsClickable();
}

// Display papers by field
function selectField(field) {
  const div = papers[field].map(p =>
    `<div class="paper-card">
      <strong>${p.title}</strong><br>
      <small>${p.author} (${p.year})</small>
      <div class="abstract">${p.abstract}</div>
      ${p.keywords.map(k => `<span class="tag">${k}</span>`).join("")}
    </div>`
  ).join("");
  document.getElementById("papers").innerHTML = div;
  makeCardsClickable();
}

// Make paper cards expandable
function makeCardsClickable() {
  document.querySelectorAll('.paper-card').forEach(card => {
    card.onclick = () => card.classList.toggle('open');
  });
}

// ADMIN PANEL
function addStudy() {
  const field = document.getElementById("field").value;
  const title = document.getElementById("title").value.trim();
  const author = document.getElementById("author").value.trim();
  const year = document.getElementById("year").value.trim();
  const abstract = document.getElementById("abstract").value.trim();
  const keywords = document.getElementById("keywords").value.split(",").map(k => k.trim());

  if (!title || !author || !year || !abstract) return alert("Fill all fields!");

  const study = { title, author, year, abstract, keywords };
  if (!papers[field]) papers[field] = [];
  papers[field].push(study);
  localStorage.setItem("papers", JSON.stringify(papers));
  alert("Study saved!");
  displayAllPapers();
}
</script>
</body>
</html>
